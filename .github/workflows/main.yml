name: Scrape Events

on:
  workflow_dispatch:
  schedule:
    - cron: '0 14 * * FRI'  # Every Friday at 10:00 AM Toronto time

jobs:
  scrape:
    runs-on: ubuntu-latest

    steps:
    - name: ðŸ§¾ Checkout repo
      uses: actions/checkout@v4

    - name: ðŸ Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: ðŸ“¦ Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: ðŸ§° Download ChromeDriver manually
      run: |
        mkdir -p driver
        wget https://storage.googleapis.com/chrome-for-testing-public/123.0.6312.105/linux64/chromedriver-linux64.zip -O driver/chromedriver.zip
        unzip driver/chromedriver.zip -d driver/
        mv driver/chromedriver-linux64/chromedriver driver/chromedriver
        chmod +x driver/chromedriver

    - name: ðŸ“¥ Download Undetectable Fingerprint Browser
      run: |
        mkdir -p fingerprint-browser
        wget https://github.com/itbrowser-net/undetectable-fingerprint-browser/releases/download/v1.0.0/fingerprint_browser_v1.0.zip -O fingerprint-browser/fingerprint_browser.zip
        unzip fingerprint-browser/fingerprint_browser.zip -d fingerprint-browser/
        chmod +x fingerprint-browser/chrome-linux/chrome

    - name: ðŸ§¼ Set CHROMEDRIVER env variable
      run: echo "CHROMEDRIVER=$(pwd)/driver/chromedriver" >> $GITHUB_ENV

    - name: ðŸ§ª Run Python Scraper
      env:
        CHROMEDRIVER: ${{ env.CHROMEDRIVER }}
      run: |
        python events_emailer.py

    - name: ðŸ“¤ Upload output HTML
      uses: actions/upload-artifact@v4
      with:
        name: eventbrite-html
        path: eventbrite_stealth_events.html
